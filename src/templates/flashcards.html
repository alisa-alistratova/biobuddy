{% extends "base.html" %}

{% block content %}

<div style="margin-bottom: 2rem;">
    <article style="background-color: var(--pico-primary-background); color: var(--pico-primary-inverse);">
        <div class="grid">
            <div>
                <h4 style="margin-bottom: 0;">Time to Learn?</h4>
                <small>Review cards scheduled for today via Spaced Repetition.</small>
            </div>
            <div style="text-align: right; align-self: center;">
                <a href="{{ url_for('study_session') }}" role="button" class="contrast">
                    ▶ Start Study Session
                </a>
            </div>
        </div>
    </article>
</div>

<div class="grid">
    
    <div>
        <article>
            <header>
                <strong>Create New Flashcard</strong>
            </header>
            <form method="POST" action="{{ url_for('flashcards') }}">
                
                <label>
                    Subject
                    <select name="subject_id" required>
                        <option value="" disabled selected>Select a subject...</option>
                        {% for s in subjects %}
                        <option value="{{ s.id }}">{{ s.name }}</option>
                        {% endfor %}
                    </select>
                </label>

                <label>
                    Question (Front Side)
                    <textarea name="question" rows="3" required placeholder="e.g. Define Osmosis"></textarea>
                </label>

                <label>
                    Answer (Back Side)
                    <textarea name="answer" rows="3" required placeholder="e.g. The movement of water molecules..."></textarea>
                </label>

                <button type="submit">Add Card</button>
            </form>
        </article>
    </div>

    <div>
        <h3 style="margin-bottom: 1rem;">My Deck ({{ cards|length }})</h3>
        
        {% if cards %}

            {% for card in cards %}
            <article style="margin-bottom: 1rem; position: relative;">
                <header>
                    <small style="background-color: #eee; padding: 2px 6px; border-radius: 4px; color: #333;">
                        {{ card.subject_name }}
                    </small>

                    <div style="float: right; display: flex; gap: 0.2rem; align-items: center;">

                        <a href="{{ url_for('edit_flashcard', card_id=card.id) }}"
                           role="button"
                           class="secondary"
                           data-tooltip="Edit Card"
                           style="
                               width: 2.5rem;
                               height: 2.5rem;
                               padding: 0;
                               display: flex;
                               align-items: center;
                               justify-content: center;
                               border: none;
                               background: transparent;
                               box-shadow: none;
                               text-decoration: none;
                           ">
                           ✏️
                        </a>

                        <form action="{{ url_for('delete_card_route', card_id=card.id) }}" method="POST" style="margin: 0;">
                            <button type="submit"
                                    class="secondary"
                                    onclick="return confirm('Are you sure you want to delete this card?');"
                                    data-tooltip="Delete Card"
                                    style="
                                        width: 2.5rem;
                                        height: 2.5rem;
                                        padding: 0;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        border: none;
                                        background: transparent;
                                        box-shadow: none;
                                        color: #c00;
                                        margin: 0;
                                    ">
                                ❌
                            </button>
                        </form>
                    </div>
                </header>

                <div style="margin-top: 0.5rem;">
                    <p style="margin-bottom: 0.5rem;"><strong>Q:</strong> {{ card.question }}</p>
                </div>

                <footer style="font-size: 0.75rem; color: #888; margin-top: 0.5rem;">
                    <div class="grid">
                        <div>Box: <strong>{{ card.leitner_box }}</strong>/5</div>
                        <div style="text-align: right;">Next: {{ card.next_review_date }}</div>
                    </div>
                </footer>
            </article>
            {% endfor %}

        {% else %}
            <article class="secondary" style="text-align: center; color: #666;">
                <h4>No cards yet!</h4>
                <p>Create your first flashcard on the left to start building your knowledge base.</p>
            </article>
        {% endif %}
    </div>

</div>
{% endblock %}
